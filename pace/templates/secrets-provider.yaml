{{- range $name, $definition := .Values.secretProviderClasses }}

apiVersion: secrets-store.csi.x-k8s.io/v1
kind: SecretProviderClass
metadata:
  name: {{ $definition.name }}
spec:
  provider: {{ $definition.provider }}
  parameters:
    {{- if eq $definition.provider "azure" }}
    useVMManagedIdentity: "true"
    tenantId: "{{ $definition.azure.tenantId }}"
    userAssignedIdentityID: "{{ $definition.azure.userAssignedIdentityID }}"
    keyvaultName: "{{ $definition.azure.keyvaultName }}"
    {{- end }}
    objects: |
      {{- $definition.objects | nindent 6 }}

    {{- if $definition.secretObjects }}
    secretObjects:
      {{- $definition.secretObjects | toYaml | nindent 6 }}
    {{- end }}

{{- end }}
